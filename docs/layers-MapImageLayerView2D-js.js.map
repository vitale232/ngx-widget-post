{"version":3,"sources":["./node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js","./node_modules/@arcgis/core/views/support/drapedUtils.js","./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","./node_modules/@arcgis/core/views/layers/MapImageLayerView.js","./node_modules/@arcgis/core/views/layers/support/popupUtils.js"],"names":[],"mappings":"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","file":"layers-MapImageLayerView2D-js.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import t from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as s}from\"../../../core/promiseUtils.js\";import{init as a}from\"../../../core/watchUtils.js\";import{RefreshableLayerView as o}from\"../../layers/RefreshableLayerView.js\";import{ExportImageParameters as p}from\"../../../layers/support/ExportImageParameters.js\";import m from\"../../layers/LayerView.js\";import{createQueryGeometry as h}from\"../../support/drapedUtils.js\";import{MapImageLayerView as n}from\"../../layers/MapImageLayerView.js\";import{BitmapContainer as d}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as g}from\"./LayerView2D.js\";import u from\"./support/ExportStrategy.js\";const c=t.getLogger(\"esri.views.2d.layers.MapImageLayerView2D\");let l=class extends(n(o(g(m)))){constructor(){super(...arguments),this._exportImageVersion=-1}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{s(e)||c.error(e)}))}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:r}=this.layer,i=r>=10.3,s=r>=10;this._bitmapContainer=new d,this.container.addChild(this._bitmapContainer),this.strategy=new u({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.imageParameters=new p({view:this.view,layer:this.layer}),this.handles.add(a(this.imageParameters,\"version\",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),\"mapimagelayerview-update\")}detach(){this.strategy.destroy(),this.handles.remove(\"mapimagelayerview-update\"),this.imageParameters.destroy(),this.imageParameters=null,this._exportImageVersion=-1,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return h(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.imageParameters.timeExtent,timestamp:this.refreshTimestamp,...i})}};e([r()],l.prototype,\"strategy\",void 0),e([r({dependsOn:[\"strategy.updating\"]})],l.prototype,\"updating\",void 0),l=e([i(\"esri.views.2d.layers.MapImageLayerView2D\")],l);var y=l;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../core/maybe.js\";import r from\"../../geometry/Extent.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as n}from\"../../core/unitUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";function a(t,i,a,o=new r){let s;if(\"2d\"===a.type)s=i*a.resolution;else if(\"3d\"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?n(o)/n(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,n){const o=n.toMap(e);if(t(o))return!1;return a(o,i(),n,s).intersects(r)}const s=new r;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t,e){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?function(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}(t.stops):e}function n(n){const r=n&&n.renderer,s=\"touch\"===(n&&n.event&&n.event.pointerType)?9:6;if(!r)return s;const o=\"visualVariables\"in r?function(t,n){if(!n)return t;const r=n.filter((t=>\"size\"===t.type)).map((n=>{const{maxSize:r,minSize:s}=n;return(e(r,t)+e(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let t=0;t<o;t++)s+=r[t];const f=Math.floor(s/o);return Math.max(f,t)}(s,r.visualVariables):s;if(\"simple\"===r.type)return t(o,r.symbol);if(\"unique-value\"===r.type){let e=o;return r.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===r.type){let e=o;return r.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return r.type,o}export{n as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{reject as a,all as p,eachAlways as i}from\"../../core/promiseUtils.js\";import{loadArcade as u}from\"../../support/arcadeOnDemand.js\";import{calculateTolerance as c}from\"../../renderers/support/clickToleranceUtils.js\";import{getRequiredFields as l,getFetchPopupTemplate as m}from\"./support/popupUtils.js\";const n=n=>{let d=class extends n{async fetchPopupFeatures(e,t){const{layer:s}=this;if(!e)return a(new o(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s}));const u=this.get(\"view.scale\"),n=[],d=async e=>{const s=0===e.minScale||u<=e.minScale,o=0===e.maxScale||u>=e.maxScale;if(e.visible&&s&&o)if(e.sublayers)e.sublayers.forEach(d);else if(e.popupEnabled){const s=m(e,{...t,defaultPopupTemplateEnabled:!1});r(s)&&n.push({sublayer:e,popupTemplate:s})}},y=s.sublayers.toArray().map(d);await p(y);const f=n.map((async({sublayer:s,popupTemplate:o})=>{await s.load().catch((()=>{}));const a=s.createQuery(),p=r(t)?t.event:null,i=c({renderer:s.renderer,event:p}),u=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=u,a.outFields=await l(s,o);const m=await this._loadArcadeModules(o);m&&m.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=u.width/i);return(await s.queryFeatures(a)).features}));return(await i(f)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e,r;return!!super.canResume()&&(null==(e=this.imageParameters)||null==(r=e.timeExtent)||!r.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\"))return u()}};return e([t()],d.prototype,\"imageParameters\",void 0),e([t()],d.prototype,\"layer\",void 0),e([t({dependsOn:[\"imageParameters.timeExtent\"]})],d.prototype,\"suspended\",void 0),d=e([s(\"esri.views.layers.MapImageLayerView\")],d),d};export{n as MapImageLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l,hasField as t}from\"../../../layers/support/fieldUtils.js\";async function i(i,d=i.popupTemplate){if(!e(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes(\"*\"))return[\"*\"];const r=s?await p(i):[],m=l(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&t(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&t(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&t(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,i as getRequiredFields};\n"],"sourceRoot":"webpack:///"}